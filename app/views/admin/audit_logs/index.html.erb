<!-- app/views/admin/audit_logs/index.html.erb -->
<div class="mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1>Audit Logs</h1>
    <%= link_to "Export CSV", export_admin_audit_logs_path(format: :csv), class: "btn btn-success" %>
  </div>

  <%= form_with url: admin_audit_logs_path, method: :get, class: "mb-3" do |f| %>
    <div class="row">
      <div class="col-md-6">
        <%= f.text_field :query, value: params[:query], class: "form-control", placeholder: "Search logs..." %>
      </div>
      <div class="col-md-2">
        <%= f.date_field :start_date, value: params[:start_date], class: "form-control", placeholder: "Start date" %>
      </div>
      <div class="col-md-2">
        <%= f.date_field :end_date, value: params[:end_date], class: "form-control", placeholder: "End date" %>
      </div>
      <div class="col-md-2">
        <%= f.submit "Filter", class: "btn btn-outline-secondary w-100" %>
      </div>
    </div>
  <% end %>

  <div class="table-responsive">
    <table class="table table-sm table-hover">
      <thead>
        <tr>
          <th>Timestamp</th>
          <th>User</th>
          <th>Action</th>
          <th>Resource</th>
          <th>IP Address</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @audit_logs.each do |log| %>
          <tr>
            <td><%= log.created_at.strftime("%Y-%m-%d %H:%M:%S") %></td>
            <td><%= log.user&.full_name || 'System' %></td>
            <td><code><%= log.action %></code></td>
            <td>
              <% if log.resource_type.present? %>
                <%= log.resource_type %>#<%= log.resource_id %>
              <% else %>
                -
              <% end %>
            </td>
            <td><code><%= log.ip_address %></code></td>
            <td>
              <%= link_to "Details", admin_audit_log_path(log), class: "btn btn-sm btn-info" %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <%= paginate @audit_logs %>
</div>